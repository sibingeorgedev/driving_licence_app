<!DOCTYPE html>
<html lang="en">
<%- include('layouts/header'); -%>

    <body>
        <!-- Responsive navbar-->
        <%- include('layouts/navbar'); -%>
            <!-- Page content-->
            <div class="container padding_30">
                <% var data=typeof data !=='undefined' ? data : {}; %>
                    <% var appt=typeof appt !=='undefined' ? appt : {}; %>
                        <% if (!data.licenseNumber) { %>
                            <form action="/g2/info" method="POST">
                                <section>
                                    <h2>Personal Information</h2>
                                    <label for="firstName">First Name:</label>
                                    <input type="text" id="firstName" name=firstName required>

                                    <label for="lastName">Last Name:</label>
                                    <input type="text" id="lastName" name=lastName required>

                                    <label for="licenseNumber">License Number (8 characters alphanumeric):</label>
                                    <input type="text" id="licenseNumber" name=licenseNumber pattern="[a-zA-Z0-9]{8}"
                                        required>

                                    <label for="age">Age:</label>
                                    <input type="number" id="age" name=age required>

                                </section>

                                <section>
                                    <h2>Car Information</h2>
                                    <label for="make">Make:</label>
                                    <input type="text" id="make" name=car_details.make required>

                                    <label for="model">Model:</label>
                                    <input type="text" id="model" name=car_details.model required>

                                    <label for="year">Year:</label>
                                    <input type="number" id="year" name=car_details.year required>

                                    <label for="platNumber">Plate Number:</label>
                                    <input type="text" id="platNumber" name=car_details.platNumber required>
                                </section>

                                <button type="submit">Submit Request</button>
                            </form>
                        <% } else if (data.appointmentId) { %>
                                <div class="appointment-confirmation">
                                    <% const appointmentDate=new Date(data.appointment.date); %>
                                        <% const options={ month: 'long' , day: 'numeric' , weekday: 'long' }; %>
                                            <p>Appointment has been scheduled for the user:
                                                <strong>
                                                    <%= data.firstName %> <%= data.lastName %>
                                                </strong>
                                                with licenseNumber: 
                                                <strong>
                                                    <%= data.licenseNumber %>
                                                </strong> on "
                                                <strong>
                                                    <%= appointmentDate.toLocaleDateString('en-US', options) %>
                                                </strong>" at "
                                                <strong>
                                                    <%= data.appointment.time %>
                                                </strong>".
                                            </p>
                                </div>
                        <% } else { %>
                                    <form>
                                        <section id="appointmentForm">
                                            <h2>Appointment Selection</h2>
                                            <label for="appointmentDate">Select Date:</label>
                                            <input type="date" id="appointmentDate" name="appointmentDate" required>
                                            <div id="appointmentTimeSelection">
                                                <label for="appointmentDate">Select Appointment Time:</label>
                                                <div id="appointmentTimeButtons">
                                                    <!-- Time buttons will be dynamically populated here based on selected date -->
                                                </div>
                                            </div>
                                        </section>
                                    </form>
                        <% } %>
            </div>
            <%- include('layouts/scripts'); -%>
            <script>
                const data = <%- JSON.stringify(data) %>; // pass data from the html to the script
            </script>
            <script src="/js/appointmentSelection.js"></script>
    </body>

</html>